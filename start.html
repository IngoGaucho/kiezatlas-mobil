<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, max-scale=1.0">
    <title>Kiezatlas-App (0.5)</title>
    <link rel="stylesheet"  href="css/jquery.mobile.theme-1.3.0.min.css">
    <link rel="stylesheet"  href="css/jquery.mobile-1.3.0.min.css">
    <link rel="stylesheet" href="leaflet/dist/leaflet.css"/>
    <link rel="stylesheet" href="css/sitestyle.css"/>
    <script src="ka-SNAPSHOT.js"></script>
    <script src="jquery-1.9.1.min.js"></script>
    <script src="leaflet/dist/leaflet.js"></script>
    <script src="jquery.mobile-1.3.0.min.js"></script>
    <style type="text/css">

        h1.my-title { margin: 10px 10px !important; }

        #content-area.ui-content { padding: 0px !important; height: 200px !important; }

        .ui-panel-content-wrap.ui-body-c.ui-panel-animate.ui-panel-content-wrap-closed { display: none; }

    </style>
    <script type="text/javascript">
        $(document).ready(function(e) {

            $.mobile.transitionFallbacks.slideout = "none"

            /** This is basically thge primitive routing implementation of the webapp**/
            $(document).on("pagechange", function(event, data) {
                var toPage = ""
                var fromPage = ""
                toPage = data.toPage[0].id
                if (data.options.fromPage != undefined) {
                    fromPage = data.options.fromPage[0].id
                }
                if (toPage.indexOf("citymaps-page") != -1) {

                    kiezatlas.setServiceUrl("http://www.kiezatlas.de/rpc/");
                    kiezatlas.setIconsFolder("http://www.kiezatlas.de/client/icons/");
                    kiezatlas.setImagesFolder("http://www.kiezatlas.de/client/images/");
                    if (fromPage.indexOf("info") != -1) {
                        // do nothing, in particular do not initialize our citymap again
                        kiezatlas.updateMobileMapGUI(false)
                    } else if (fromPage.indexOf("citymaps-page") == -1) {
                        console.log(".. initializing citymap-page froim cityMapsPAge ...")
                        kiezatlas.initializeMobileCityMapView()
                    }

                } else if (toPage.indexOf("citymaps-list") != -1) {
                    if (kiezatlas.markers != undefined) kiezatlas.clearMarkers() // clean up on the way back(tothelist)
                    // console.log("load citymaps-listing..")
                    $(".my-title").html("Berliner Kiezatlas");
                    if (kiezatlas.publishedMaps == undefined || kiezatlas.publishedMaps.length == 0) {
                        kiezatlas.getPublishedMobileCityMaps()
                        kiezatlas.renderMobileCityMapList(kiezatlas.publishedMaps)
                    } else {
                        console.log("re-rendering citymaps-listing.." + kiezatlas.publishedMaps.length)
                        kiezatlas.renderMobileCityMapList(kiezatlas.publishedMaps)
                    }
                }
            })

            /** Handling application initialization by deep-linking **/
            if (window.location.href.indexOf("#citymaps-page") == -1 && 
                window.location.href.indexOf("#infoo") == -1) {
                // this is just here because initially, no "pagechange" is fired by jqm
                kiezatlas.getPublishedMobileCityMaps()
                kiezatlas.renderMobileCityMapList(kiezatlas.publishedMaps)
            } else {
                kiezatlas.cityMapId = kiezatlas.getURLParameter("mapId")
                kiezatlas.workspaceId = kiezatlas.getURLParameter("wsId")
                // set URL params, "pagechange" event will do the rest (init citymaps-page view)
            }

        });
    </script>
</head>
<body>

    <div id="citymaps-list" data-role="page" data-filter-placeholder="Suche ...">
        <div data-role="header" data-theme="c">
              <h1 class="my-title" >Berliner Kiezatlas</h1>
              <!-- a href="#" data-icon="bars">&nbsp;</a-->
        </div>
        <div data-role="content" data-theme="c">
            <!-- data-inset="true" -->
            <ul data-role="listview" data-theme="c" class="citymap-listing" data-filter="true">
                <li data-role="list-divider" data-theme="e" id="all-citymaps">Alle Stadtpl&auml;ne</li>
            </ul>
        </div>
    </div>

    <div id="citymaps-page" data-role="page">

        <div data-role="header" data-theme="c">
            <!--a target="_blank" href="http://m.kiezatlas.de/ehrenamt" data-icon="home">&nbsp;</a-->
            <!-- a class="back" href="#citymaps-list" data-transition="flow" data-icon="back">&nbsp;</a-->
            <h1 class="my-title" >Lade Stadtplanansicht..</h1>
            <!-- a href="#" data-icon="bars">&nbsp;</a-->
            <a class="back" style="display: none;" href="#infoo" data-transition="slidefade"></a>
        </div>

        <div id="map" class="fullsize"></div>

        <!--div id="details" data-role="panel" data-position="right">
            <a href="#my-header" data-rel="close">Close panel</a>
        </div-->

    </div>

    <div id="infoo" data-role="page">

        <div data-role="header" data-theme="c">
            <!--a target="_blank" href="http://m.kiezatlas.de/ehrenamt" data-icon="home">&nbsp;</a-->
            <!-- a class="back" href="#citymaps-page" data-transition="slidefade" data-icon="back">&nbsp;</a-->
            <h1 class="my-title" >Detailansicht</h1>
            <!-- a href="#" data-icon="bars">&nbsp;</a-->
        </div>

        <div id="infoo-area" data-role="content">
            <p>Info-Layer..</p>
        </div-->

    </div>

</bod>
</html>

